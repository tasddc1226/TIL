# AWS IAM
> IAM = Identity and Access Management, Global Service

## IAM의 사용 가능한 구성
- IAM에는 한 사용자는 하나의 조직(Group)에만 속할 수 있다.
- **한 그룹은 다른 그룹을 포함시킬 수 없다. 단지 사용자만 포함할 수 있다.**
- 어떤 사용자가 특정 그룹에 포함되어있지 않는 방법도 가능하지만 추천하는 방법은 아니다.
- **또한 한 사용자는 다른 여러 그룹에 속할 수 있다.**

### 사용자와 그룹을 생성하는 이유?
- AWS 계정을 사용하도록 허용하기 위함이다.
- 그리고 허용을 위해서 이들에게 권한을 부여해야 한다.
- 부여하는 방법으로는 JSON 문서를 통해서 가능하다.

```json
{
    "Version": "2017-10-10",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": "ec2:Describe*",
            "Resource": "*"
        },
        {
            "Effect": "Allow",
            "Action": "elasticloadbalancing:Describe*",
            "Resource": "*"
        }
    ]
}
```

- 어느 특정 유저에게 권한을 너무 많이 설정한다면 큰 비용 또는 보안 문제를 야기할 수 있기 때문에
- AWS는 **최소 권한의 원칙**을 적용해야 한다.
- 사용자가 꼭 필요로 하는 것 이상의 권한을 주지 않도록 해야한다.

## IAM 정책 구조 요소

- 아래의 JSON 형식의 문서를 보고 하나 하나씩 살펴보자.

```json
{
    "Version": "2017-10-17",
    "Id": "S3-Account-Permissions",
    "Statement": [
        {
            "Sid": "1",
            "Effect": "Allow",
            "Principal": {
                "AWS": ["arn:aws:iam::123456789012:root"]
            },
            "Action": [
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": ["arn:aws:s3:::mybucket/*"]
        }
    ]
}
```

- 버전 숫자를 포함한다.
- 정책을 식별하는 `Id`도 존재하지만 선택사항이다.
- 문장(`Statement`)은 하나일 수도 여러 개일 수도 있다.
- `Sid` : 문장 ID로 식별자 (선택사항)
- `effect` : 문장이 특정 API에 접근하는 것을 허용할지 거부할지에 대한 내용이다.
- `Principal` : 특정 정책이 적용될 사용자, 계정, 혹은 역할로 구성된다. (위의 예시에서는 루트 계정에 적용)
- `Action` : `effect`에 기반하여 허용, 거부되는 API 호출 목록이다.
- `Resource` : 적용될 `Action`의 리소스 목록이다.
- `Condition` : `Statement`가 언제 적용될지를 결정하는 조건이 있다. (선택사항이므로  위의 예시에서는 없음)


## IAM - Password Policy
- 유저와 그룹에 대한 정보가 침해당하지 않도록 보호하기 위함.
- 두 가지 방어 메커니즘이 있다. 알아보자

### 1. 비밀번호 정책의 정의
> 비밀번호 정책을 이용하면 계정에 대한 치명적인 공격을 막아내는 데 큰 도움이 된다.

- 비밀번호가 강력할수록 계정의 보안이 철저해짐
- AWS에서는 다양한 옵션을 이용해 비밀번호 정책 생성이 가능
  - 옵션 1 : 비밀번호 최소 길이 설정
  - 옵션 2 : 특정 유형의 글자 사용 요구 (대문자, 소문자, 숫자, 물음표 ..)
- 비밀번호 변경에 대한 허용 또는 금지 가능
- 일정 기간이 지나면 비밀번호를 만료시켜 새 비밀번호 설정 요구
- 사용자가 비밀번호의 재사용을 막아 비밀번호 변경 시에 동일한 비밀번호나 이전에 사용했던 비밀번호를 사용하지 못하도록 함.


### 2. 다요소 인증, MFA(Multi Factor Authentication)
> AWS에서는 비밀번호 이외의 수단으로 이 방법을 필수적으로 사용하도록 권장하고 있다.

- AWS에서의 MFA 장치 옵션?
  - 가상 MFA 장치 : google Authenticator(Only Phone), Authy(PC + Phone)
  - U2F 보안 키 : 유비키(YubiKey), 전자 열쇠 개념
  - 하드웨어 키 팝 MFA 장치 : 차키 같은데 번호가 있음

#### MFA ?
  - MFA는 비밀번호와 가지고있는 보안 장치를 함께 사용하는 것!
  - 장점으로는 비밀번호가 유출되어도 인증 과정에서 본인의 기기(휴대전화)의 물리적인 장치가 추가로 필요해지기 때문에 계정이 보호될 수 있다는 점이다.

